{% extends "base.html" %}
{% load static %}

{% block title %}Experiences | Hootel Resorts, Hotels &amp; Residences{% endblock %}

{% block extra_css %}
<style>
  /* Additional styles specific to the experiences page */
  
  /* Modal styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
  }
  
  .modal-content {
    background-color: #f3eee7;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 500px;
    text-align: center;
    border-radius: 5px;
  }
  
  .modal-content h3 {
    margin-bottom: 1rem;
  }
  
  .modal-content p {
    margin-bottom: 1.5rem;
  }
  
  .modal-content button {
    background-color: #313131;
    color: white;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 3px;
    cursor: pointer;
  }
  
  .modal-content button:hover {
    background-color: #1a1a1a;
  }
  
  .experience-hero {
    position: relative;
    height: 600px;
    overflow: hidden;
    margin-bottom: 3rem;
  }
  
  .experience-hero img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .slider-card .card__post-link-content {
    padding: 1rem;
    border-top: 1px solid #dad9d7;
  }
  
  .experience-hero-content {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 4rem 2rem 2rem;
    background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
    color: #F3EEE7;
  }
  
  .experience-detail {
    padding: 4rem 0;
  }
  
  .experience-detail:nth-child(even) {
    background-color: #F3EEE7;
  }
  
  .experience-image {
    position: relative;
    height: 100%;
    min-height: 400px;
  }
  
  .experience-image img {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .experience-content {
    padding: 2rem;
  }
  
  @media (max-width: 768px) {
    .experience-hero {
      height: 300px;
    }
    
    .experience-image {
      min-height: 300px;
    }
  }



  .destinations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
    margin-top: 3rem;
  }

  .filter-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 2rem;
    padding: 1rem 0;
    border-bottom: 1px solid #dad9d7;
  }
  
  .filter-bar button {
    background: none;
    border: none;
    padding: 0.5rem 1rem;
    cursor: pointer;
    font-size: 0.875rem;
    letter-spacing: 0.1rem;
    text-transform: uppercase;
    color: #313131;
    opacity: 0.7;
    transition: opacity 0.3s;
  }
  
  .filter-bar button.active {
    opacity: 1;
    border-bottom: 1px solid #313131;
  }
  
  /* Search Bar Styles */
  .search-bar {
    max-width: 500px;
    margin: 0;
  }
  
  .search-bar input {
    padding: 0.75rem 1rem;
    border: none;
    border-bottom: 1px solid #dad9d7;
    border-radius: 0;
    font-size: 1rem;
    width: 100%;
    background: transparent;
  }
  
  .search-bar input:focus {
    outline: none;
    border-color: #313131;
  }
  
  /* Ensure consistent image dimensions in destination cards */
  .slider-card {
    height: 100%;
  }
  
  .media--responsive {
    height: 250px;
    overflow: hidden;
  }
  
  .slider-card .media--responsive img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }
  
  .slider-card .media--responsive img:hover {
    transform: scale(1.05);
  }

  .slider-card figcaption {
    flex: 1;
    padding: 1rem;
  }
  
  .slider-card figcaption p {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 1rem;
  }
  
  @media (max-width: 768px) {
    .destination-hero {
      height: 300px;
    }
  }
  
  /* Banner Section Styles */
  .banner-section {
    position: relative;
    overflow: hidden;
  }
  
  .banner-section img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    min-height: 400px;
  }
  
  .banner-section .col-md-6 {
    padding: 0;
  }
  
  .banner-section .col-md-6:first-child {
    position: relative;
  }
  
  .banner-section .col-md-6:last-child {
    padding: 2rem;
  }

  /* Express Interest button styles */
  .express-interest-btn {
    background: none;
    border: none;
    padding: 0;
    font: inherit;
    cursor: pointer;
    text-decoration: none;
    color: inherit;
  }
  
  .express-interest-btn:hover {
    text-decoration: underline;
  }

</style>
{% endblock %}

{% block content %}
<!-- Hero Banner -->
<section class="destination-hero">
  <video autoplay muted loop class="w-100">
    <source src="{% static 'videos/experiences-hero.mp4' %}" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</section>

<!-- Intro Section -->
<section class="container container--spacer gutter">
  <header class="hgroup hgroup--limited text--centered">
    <p class="subtitle">Experiences at Hootel</p>
    <h2 class="heading-h">Extraordinary Journeys for the Eextraordinary</h2>
    <div class="hgroup__intro">
      <p>From spiritual pilgrimages to cultural discoveries, Hootel curates transformative experiences that immerse guests in the spirit of each destination. Each Hootel property offers its own selection of activities that celebrate the surrounding landscape and culture.</p>
    </div>
    <div class="hgroup__intro">
      <p>Experiences are curated by Hootel's team and are <strong><u>invite-only</u></strong>. If you'd like to be added to the list of authorized users, please request access.</p>

      </div>
  </header>


  <!-- Search Bar -->
  <div class="search-bar mb-4">
    <input type="text" id="destinationSearch" class="form-control" placeholder="Search destinations..." aria-label="Search destinations">
  </div>
  
  <!-- Filter Bar -->
  <div class="filter-bar">
    <button class="active" data-filter="all">All Experiences</button>
    {% for collection in collections %}
      {% if collection.visibility == 'private' %}
        <button data-filter="collection-{{ collection.id }}">{{ collection.title }}</button>
      {% endif %}
    {% endfor %}
  </div>
  
  <!-- Destinations Grid -->
  <div class="destinations-grid">
    {% for destination in destinations %}
      {% if destination.has_private_collection %}
        <div class="slider-card" data-region="{{ destination.region }}" data-collections="{{ destination.collection_ids|join:',' }}">
          <article class="card card--centered">
            <div class="media media--responsive">
              {% if destination.representative_image %}
                <img src="{{ destination.representative_image }}" alt="{{ destination.name }}" class="img-fluid">
              {% else %}
                <img src="{% static 'images/placeholder.jpg' %}" alt="{{ destination.name }}" class="img-fluid">
              {% endif %}
            </div>
            <figcaption>
              <h3>{{ destination.name }}</h3>
              <p>{{ destination.description }}</p>
            </figcaption>
            <div class="card__post-link-content">
              {% if destination.is_authorized_for_user %}
                <a href="{% url 'item_detail' item_title=destination.name %}" class="cta__link card__link__cta underline">Discover</a>
              {% else %}
                <a href="#" class="cta__link card__link__cta express-interest-btn" 
                   data-collection-id="{{ destination.collection_ids|first }}"
                   data-destination-name="{{ destination.name }}">
                  Express Interest
                </a>
              {% endif %}
            </div>
          </article>
        </div>
      {% endif %}
    {% endfor %}
  </div>



</section>




<!-- Call to Action Section -->
<section class="container--spacer container gutter text--centered">
  <div class="py-5">
    <h2 class="heading-h mb-4">Plan Your Hootel Journey</h2>
    <a href="#" class="button button--dark">Contact Us</a>
  </div>
</section>

<!-- Request Modal -->
<div id="requestModal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Access Request</h3>
    <p id="modalMessage"></p>
    <button id="closeModal">Close</button>
  </div>
</div>
{% endblock %}








{% block extra_js %}
<script>
  // Destinations page specific JavaScript
  document.addEventListener('DOMContentLoaded', function() {
    // Search functionality
    const searchInput = document.getElementById('destinationSearch');
    const filterButtons = document.querySelectorAll('.filter-bar button');
    const destinations = document.querySelectorAll('.destinations-grid .slider-card');
    
    function filterDestinations() {
      const searchTerm = searchInput.value.toLowerCase();
      const activeFilter = document.querySelector('.filter-bar button.active').getAttribute('data-filter');
      
      destinations.forEach(dest => {
        const title = dest.querySelector('h3').textContent.toLowerCase();
        const description = dest.querySelector('p').textContent.toLowerCase();
        const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
        
        let matchesFilter = true;
        if (activeFilter !== 'all') {
          if (activeFilter.startsWith('collection-')) {
            const collectionId = activeFilter.split('-')[1];
            const collections = dest.getAttribute('data-collections').split(',');
            matchesFilter = collections.includes(collectionId);
          } else {
            matchesFilter = dest.getAttribute('data-region') === activeFilter;
          }
        }
        
        dest.style.display = matchesSearch && matchesFilter ? 'block' : 'none';
      });
    }
    
    // Add search input event listener
    searchInput.addEventListener('input', filterDestinations);
    
    // Filter functionality
    filterButtons.forEach(button => {
      button.addEventListener('click', function() {
        // Update active button
        filterButtons.forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        
        // Filter destinations
        filterDestinations();
      });
    });

    // Access Request functionality
    const expressInterestBtns = document.querySelectorAll('.express-interest-btn');
    const modal = document.getElementById('requestModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalMessage = document.getElementById('modalMessage');
    const closeModal = document.getElementById('closeModal');
    
    expressInterestBtns.forEach(btn => {
      btn.addEventListener('click', async function(e) {
        e.preventDefault(); // Prevent default link behavior
        const collectionId = this.getAttribute('data-collection-id');
        const destinationName = this.getAttribute('data-destination-name');
        
        try {
          const response = await fetch('/access-request/create/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
              'X-CSRFToken': getCookie('csrftoken')
            },
            body: `collection_id=${collectionId}&reason=Requesting access to ${destinationName}`
          });
          
          const data = await response.json();
          
          modalTitle.textContent = data.success ? 'Success' : 'Error';
          modalMessage.textContent = data.message;
          modal.style.display = 'block';
          
        } catch (error) {
          modalTitle.textContent = 'Error';
          modalMessage.textContent = 'An error occurred while submitting your request. Please try again.';
          modal.style.display = 'block';
        }
      });
    });
    
    // Close modal when clicking the close button
    closeModal.addEventListener('click', function() {
      modal.style.display = 'none';
    });
    
    // Close modal when clicking outside the modal content
    window.addEventListener('click', function(event) {
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    });
    
    // Helper function to get CSRF token
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
  });
</script>
{% endblock %} 