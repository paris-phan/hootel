{% extends "base/librarian_base.html" %}

{% block title %}{{ room.name }} - HotelManager6000{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h2 class="mb-0">{{ room.name }}</h2>
            <div>
                {% if user.is_staff %}
                <a href="{% url 'update_room' room.id %}" class="btn btn-light btn-sm">Edit Room</a>
                <a href="{% url 'delete_room' room.id %}" class="btn btn-danger btn-sm">Delete Room</a>
                {% endif %}
            </div>
        </div>
        <div class="card-body">
            <!-- Room Image -->
            <div class="mb-4">
                <img src="{{ room.image_url }}" class="img-fluid" alt="{{ room.name }}" style="width: 100%; height: 350px; object-fit: cover;">
            </div>

            <!-- Room Details -->
            <div class="mb-4">
                <h5 class="card-title"><i class="bi bi-door-closed"></i> Room {{ room.room_number }} - Floor {{ room.floor }}</h5>
                <p class="card-text">{{ room.description|linebreaks }}</p>
                <p class="card-text"><small class="text-muted">Added on {{ room.created_at|date:"F j, Y" }}</small></p>

                {% if user.is_staff and room.created_by %}
                <hr>
                <p class="card-text"><small class="text-muted">Added by {{ room.created_by.username }}</small></p>
                {% endif %}
            </div>

            <!-- Action Buttons -->
            <div class="mb-4">
                {% if not user.is_staff %}
                <a href="{% url 'patron:book_room' room.id %}" class="btn btn-success">Book Now</a>
                {% endif %}

                {% if user.is_staff %}
                <a href="{% url 'manage_rooms' %}" class="btn btn-outline-secondary">Manage Rooms</a>
                {% endif %}
            </div>

            <!-- Room Amenities -->
            <div class="mb-4">
                <h4>Amenities</h4>
                <div class="row">
                    {% if room.has_wifi %}
                    <div class="col-md-3">
                        <i class="bi bi-wifi"></i> WiFi
                    </div>
                    {% endif %}
                    {% if room.has_tv %}
                    <div class="col-md-3">
                        <i class="bi bi-tv"></i> TV
                    </div>
                    {% endif %}
                    {% if room.has_bathroom %}
                    <div class="col-md-3">
                        <i class="bi bi-water"></i> Private Bathroom
                    </div>
                    {% endif %}
                    {% if room.has_balcony %}
                    <div class="col-md-3">
                        <i class="bi bi-door-open"></i> Balcony
                    </div>
                    {% endif %}
                    {% if room.is_accessible %}
                    <div class="col-md-3">
                        <i class="bi bi-universal-access"></i> Accessible
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Bookings Table -->
            {% if user.is_staff %}
            <div class="mt-4">
                <h4>Current Bookings</h4>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Guest</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if bookings %}
                            {% for booking in bookings %}
                            <tr>
                                <td>{{ booking.user.username }}</td>
                                <td>{{ booking.check_in_date|date:"M d, Y" }}</td>
                                <td>{{ booking.check_out_date|date:"M d, Y" }}</td>
                                <td>
                                    <span class="badge {% if booking.status == 'APPROVED' %}bg-success{% elif booking.status == 'PENDING' %}bg-warning{% else %}bg-danger{% endif %}">
                                        {{ booking.status }}
                                    </span>
                                </td>
                                <td>
                                    <a href="{% url 'patron:view_booking' booking.id %}" class="btn btn-sm btn-info">View</a>
                                </td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="5" class="text-center">No bookings for this room yet.</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            <!-- User's Own Bookings -->
            {% if not user.is_staff %}
            <div class="mt-4">
                <h3>Your Bookings for This Room</h3>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if user_bookings %}
                            {% for booking in user_bookings %}
                            <tr>
                                <td>{{ booking.check_in_date|date:"M d, Y" }}</td>
                                <td>{{ booking.check_out_date|date:"M d, Y" }}</td>
                                <td>
                                    <span class="badge {% if booking.status == 'APPROVED' %}bg-success{% elif booking.status == 'PENDING' %}bg-warning{% else %}bg-danger{% endif %}">
                                        {{ booking.status }}
                                    </span>
                                </td>
                                <td>
                                    <a href="{% url 'patron:view_booking' booking.id %}" class="btn btn-sm btn-info">View</a>
                                </td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="4" class="text-center">You don't have any bookings for this room yet.</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %} 