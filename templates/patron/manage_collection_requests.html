{% extends base_template %}
{% load static %}

{% block title %}Manage Collection Access Requests - HotelManager6000{% endblock %}

{% block extra_css %}
<!-- Bootstrap Icons (optional) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
<!-- Animate.css for subtle fade-in or other animations -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

<style>
  /* Page Wrapper */
  .requests-page {
    background-color: #f5f7fa;
    font-family: 'Segoe UI', sans-serif;
    padding-bottom: 2rem;
  }

  /* Hero Section */
  .requests-hero {
    position: relative;
    width: 100%;
    height: 220px; /* Adjust as needed */
    background: linear-gradient(135deg, #007bff, #0056b3);
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }
  .hero-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.3);
  }
  .hero-content {
    position: relative;
    z-index: 2;
    text-align: center;
    color: #fff;
  }
  .hero-content h1 {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }
  .hero-content p.lead {
    font-size: 1.1rem;
    margin-bottom: 0;
  }

  /* Container for Cards */
  .requests-container {
    padding: 0 1rem;
  }

  /* Card Styles */
  .card {
    border: none;
    border-radius: 10px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    margin-bottom: 1.5rem;
  }
  /* Gradient header for Pending Requests (blue) */
  .card-header.bg-primary {
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: #fff;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
  }
  /* Gradient header for Request History (dark gray) */
  .card-header.bg-secondary {
    background: linear-gradient(135deg, #6c757d, #545b62);
    color: #fff;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
  }

  /* Pill-Shaped Buttons */
  .btn {
    border-radius: 50px;
    transition: all 0.3s ease;
    padding: 0.5rem 1.5rem;
    font-weight: 500;
    text-transform: uppercase;
    margin-right: 0.5rem;
    margin-top: 0.5rem;
    box-shadow: none;
  }
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(0,0,0,0.15);
  }
  .btn-success {
    background: linear-gradient(135deg, #28a745, #218838);
    border: none;
    color: #fff;
  }
  .btn-success:hover {
    background: linear-gradient(135deg, #218838, #1a6830);
  }
  .btn-danger {
    background: linear-gradient(135deg, #dc3545, #b52a36);
    border: none;
    color: #fff;
  }
  .btn-danger:hover {
    background: linear-gradient(135deg, #b52a36, #941f29);
  }
  .btn-secondary {
    background: linear-gradient(135deg, #6c757d, #545b62);
    border: none;
    color: #fff;
  }
  .btn-secondary:hover {
    background: linear-gradient(135deg, #545b62, #3e4549);
  }

  /* Table & Badge Styling */
  .table-striped tbody tr:hover {
    background-color: #f9f9f9;
  }
  .badge.bg-success {
    background-color: #28a745 !important;
  }
  .badge.bg-danger {
    background-color: #dc3545 !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="requests-page">
  <!-- Hero Section -->
  <div class="requests-hero animate__animated animate__fadeIn">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <h1>Manage Collection Access Requests</h1>
      <p class="lead">Review and respond to requests for access to your private collections</p>
    </div>
  </div>

  <!-- Main Container for Cards -->
  <div class="requests-container container animate__animated animate__fadeInUp">
    <!-- Pending Requests -->
    <div class="card mb-4">
      <div class="card-header bg-primary">
        <h4 class="mb-0"><i class="bi bi-clock-history"></i> Pending Requests</h4>
      </div>
      <div class="card-body">
        {% if pending_requests %}
          <div class="table-responsive">
            <table class="table table-striped align-middle">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Collection</th>
                  <th>Request Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for request in pending_requests %}
                <tr>
                  <td>{{ request.user.username }}</td>
                  <td>
                    <a href="{% url 'patron:view_collection_items' request.collection.id %}">
                      {{ request.collection.name }}
                    </a>
                  </td>
                  <td>{{ request.request_date|date:"F j, Y, g:i a" }}</td>
                  <td>
                    <div class="btn-group" role="group">
                      <a href="{% url 'patron:process_access_request' request.id 'approve' %}"
                         class="btn btn-sm btn-success">
                        <i class="bi bi-check-circle"></i> Approve
                      </a>
                      <a href="{% url 'patron:process_access_request' request.id 'reject' %}"
                         class="btn btn-sm btn-danger">
                        <i class="bi bi-x-circle"></i> Reject
                      </a>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p>You have no pending access requests.</p>
        {% endif %}
      </div>
    </div>

    <!-- Processed Requests History -->
    <div class="card">
      <div class="card-header bg-secondary">
        <h4 class="mb-0"><i class="bi bi-clock-history"></i> Request History</h4>
      </div>
      <div class="card-body">
        {% if processed_requests %}
          <div class="table-responsive">
            <table class="table table-striped align-middle">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Collection</th>
                  <th>Request Date</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for request in processed_requests %}
                <tr>
                  <td>{{ request.user.username }}</td>
                  <td>
                    <a href="{% url 'patron:view_collection_items' request.collection.id %}">
                      {{ request.collection.name }}
                    </a>
                  </td>
                  <td>{{ request.request_date|date:"F j, Y, g:i a" }}</td>
                  <td>
                    <span class="badge
                      {% if request.status == 'APPROVED' %}
                        bg-success
                      {% else %}
                        bg-danger
                      {% endif %}">
                      {{ request.status }}
                    </span>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p>You have no processed access requests.</p>
        {% endif %}
      </div>
    </div>

    <div class="mt-4">
      <a href="{% url 'patron:view_collections' %}" class="btn btn-secondary">Back to Collections</a>
    </div>
  </div>
</div>
{% endblock %}
