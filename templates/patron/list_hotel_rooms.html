{% extends base_template %}
{% load static %}

{% block title %}{{ hotel.name }} - Rooms{% endblock %}

{% block extra_css %}
<!-- Include Animate.css for smooth entrance animations -->
<link rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
      integrity="sha384-zMAROxHwkB+ThP5oGSfKlqiGxHGNJyxwYcxXmTzxNzYwBzV0MQeXxqmF7Pe2BZr"
      crossorigin="anonymous">

<style>
  /* Page background and typography */
  body {
    background-color: #f5f7fa;
    font-family: 'Segoe UI', sans-serif;
  }

  /* Hero section for hotel info */
  .hero-rooms {
    position: relative;
    width: 100%;
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    color: #fff;
    padding: 2rem 1rem;
    border-radius: 0 0 25px 25px;
    margin-bottom: 2rem;
  }
  .hero-rooms .hotel-image {
    max-height: 200px;
    object-fit: cover;
    border-radius: 10px;
    transition: transform 0.3s ease;
  }
  .hero-rooms .hotel-image:hover {
    transform: scale(1.05);
  }
  
  /* Cards */
  .card {
    border: none;
    border-radius: 10px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
  }
  .card-img-top {
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
  }

  /* Animate fade-up for each card */
  .animate-fade-up {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeUp 0.8s forwards;
  }
  @keyframes fadeUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Enhanced Buttons */
  .btn {
    border-radius: 30px;       /* Rounded pill shape */
    transition: all 0.3s ease;
    box-shadow: none;
  }
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(0,0,0,0.1);
  }

  /* Gradient backgrounds for primary, secondary, success, danger */
  .btn-primary {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    border: none;
    color: #fff;
  }
  .btn-primary:hover {
    background: linear-gradient(135deg, #0056b3 0%, #00408f 100%);
  }
  .btn-secondary {
    background: linear-gradient(135deg, #6c757d 0%, #565e64 100%);
    border: none;
    color: #fff;
  }
  .btn-secondary:hover {
    background: linear-gradient(135deg, #565e64 0%, #3e4549 100%);
  }
  .btn-success {
    background: linear-gradient(135deg, #28a745 0%, #218838 100%);
    border: none;
    color: #fff;
  }
  .btn-success:hover {
    background: linear-gradient(135deg, #218838 0%, #1a6830 100%);
  }
  .btn-danger {
    background: linear-gradient(135deg, #dc3545 0%, #b52a36 100%);
    border: none;
    color: #fff;
  }
  .btn-danger:hover {
    background: linear-gradient(135deg, #b52a36 0%, #941f29 100%);
  }

  /* "Add to Collection" dropdown styling */
  .dropdown-toggle {
    border-radius: 30px;
  }

  /* Spacing for "Back" buttons */
  .back-buttons a {
    margin-right: 1rem;
    margin-top: 1rem;
  }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-rooms">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8 animate__animated animate__fadeInLeft">
        <h1 class="display-5 fw-bold mb-3">{{ hotel.name }} - Available Rooms</h1>
        <p class="lead">{{ hotel.description }}</p>
        <p><strong>Location:</strong> {{ hotel.location }}</p>
      </div>
      <div class="col-md-4 text-md-end text-center animate__animated animate__fadeInRight">
        <img src="{{ hotel.image_url }}" alt="{{ hotel.name }}" class="img-fluid hotel-image">
        {% if user.is_staff %}
        <div class="mt-3">
          <a href="{% url 'patron:add_room' %}" class="btn btn-success">Add Room</a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Rooms Listing -->
<div class="container">
  <div class="row">
    {% for room in rooms %}
    <div class="col-md-4 mb-4 animate-fade-up">
      <div class="card h-100">
        <img src="{{ room.image_url }}" class="card-img-top" alt="Room {{ room.number }}" style="height: 200px; object-fit: cover;">
        <div class="card-body">
          <h5 class="card-title mb-2">Room {{ room.number }}</h5>
          <h6 class="card-subtitle mb-3 text-muted">{{ room.type }}</h6>
          <p class="card-text">{{ room.description|truncatechars:100 }}</p>
          <p><strong>${{ room.price_per_night }}</strong> per night</p>
          <p><strong>Capacity:</strong> {{ room.capacity }} person{{ room.capacity|pluralize }}</p>
          {% if room.is_available %}
          <span class="badge bg-success">Available</span>
          {% else %}
          <span class="badge bg-danger">Unavailable</span>
          {% endif %}
        </div>
        <div class="card-footer bg-white border-0">
          <div class="d-flex justify-content-between">
            <a href="{% url 'patron:view_room' room.id %}" class="btn btn-sm btn-primary">View Details</a>
            {% if user.is_authenticated %}
            <div class="dropdown">
              <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton-{{ room.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                Add to Collection
              </button>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton-{{ room.id }}">
                {% for collection in user_collections %}
                <li>
                  <form method="post" action="{% url 'patron:add_room_to_collection' room.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="collection_id" value="{{ collection.id }}">
                    <button type="submit" class="dropdown-item">{{ collection.name }}</button>
                  </form>
                </li>
                {% empty %}
                <li><a class="dropdown-item disabled" href="#">No collections yet</a></li>
                {% endfor %}
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{% url 'patron:create_collection' %}">Create new collection</a></li>
              </ul>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12">
      <div class="alert alert-info">
        No rooms available for this hotel yet.
        {% if user.is_staff %}
        <a href="{% url 'patron:add_room' %}" class="alert-link">Add rooms as a librarian</a>.
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="back-buttons">
    {% if user.is_staff %}
    <a href="{% url 'patron:view_hotel' hotel.id %}" class="btn btn-secondary">Back to Hotel</a>
    {% else %}
    <a href="{% url 'patron:patron_view_hotel' hotel.id %}" class="btn btn-secondary">Back to Hotel</a>
    {% endif %}
    <a href="{% url 'home' %}" class="btn btn-outline-secondary">Back to Home</a>
  </div>
</div>
{% endblock %}
